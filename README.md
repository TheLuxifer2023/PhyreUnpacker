# PhyreUnpacker ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ–º –∏ –ø–µ—Ä–µ—É–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —à—Ä–∏—Ñ—Ç—ã –∏–∑ PhyreEngine `.phyre`

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ `.phyre` —Ñ–∞–π–ª–æ–≤ bitmap‚Äë—à—Ä–∏—Ñ—Ç—ã (`PBitmapFont`) –≤–º–µ—Å—Ç–µ —Å –∏—Ö –∞—Ç–ª–∞—Å–æ–º (`PTexture2D`) –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, –∞ —Ç–∞–∫–∂–µ **–ø–µ—Ä–µ—É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç** –∏—Ö —Å –Ω–æ–≤—ã–º TTF —à—Ä–∏—Ñ—Ç–æ–º, –∑–∞–º–µ–Ω—è—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥–ª–∏—Ñ—ã –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (Extraction)
- –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞: `analyzeCluster()` + `loadCluster()` —Å namespace‚Äëmapping
- –î–æ—Å—Ç—É–ø –∫ –ø–∏–∫—Å–µ–ª—è–º: `PTexture2D::map()` (D3D11 staging), –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ DX11 —Ä–µ—Å—É—Ä—Å–∞—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: L8, A8, LA8, RGBA8/ARGB8 (–±–µ—Ä—ë—Ç—Å—è –∞–ª—å—Ñ–∞ –∏–ª–∏ max‚Äë–∫–∞–Ω–∞–ª), DXT1/3/5, BC4 (–¥–µ–∫–æ–¥ –ø–æ –∞–ª—å—Ñ–µ/—Ü–≤–µ—Ç—É)
- –≠–∫—Å–ø–æ—Ä—Ç: `*.ppm`, `*_metadata.xml`, `*_characters.json`, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π `*.fgen`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: `*_validate.txt` –æ—Ç—á—ë—Ç + `*_overlay.ppm` –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≥–ª–∏—Ñ–æ–≤ (OOB/empty/sparse)
- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –∏–º–µ–Ω–∏ TTF: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `.fgen` —Ä—è–¥–æ–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `<–∏–º—è>.ttf.name.txt` —Å–æ —Å—Ç—Ä–æ–∫–æ–π 2 `.fgen`

### –ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∞ (Repacking)
- **–ü—Ä—è–º–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ FreeType API**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PhyreFont API` –∏ `FT_Load_Char` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–ª–∏—Ñ–æ–≤ –∏–∑ TTF
- **–í—ã–±–æ—Ä–æ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞**: –∑–∞–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `.fgen` —Å–∏–º–≤–æ–ª—ã, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ rotated glyphs**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç—ã—Ö –≥–ª–∏—Ñ–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–∫–æ–º X/Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- **–ë–∏–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è**: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–∏—Ñ–æ–≤ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ TTF –∫ —Ü–µ–ª–µ–≤–æ–º—É —Ä–∞–∑–º–µ—Ä—É –≤ –∞—Ç–ª–∞—Å–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–ø—É—Å–∫–∞–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –≥–ª–∏—Ñ–æ–≤**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π bitmap –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≥–ª–∏—Ñ–∞
- **D3D11 platform ID**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º `D3D11` platform ID –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∏–≥—Ä–æ–π
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ UV –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —Ä–∞–∑–º–µ—Ä—ã, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —à—Ä–∏—Ñ—Ç–∞

### –ê—Ä—Ö–∏–≤—ã –∏ —Ñ–æ—Ä–º–∞—Ç—ã
- **OFS3 —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ OFS3 –∞—Ä—Ö–∏–≤–æ–≤ (`.l2b` —Ñ–∞–π–ª—ã)
- **L2B –∞—Ä—Ö–∏–≤—ã**: —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ Level 2 Binary —Ñ–∞–π–ª–æ–≤ —Å —Ç–∞–±–ª–∏—Ü–µ–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- **–ê–Ω–∞–ª–∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤**: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤, –ø–ª–∞—Ç—Ñ–æ—Ä–º –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ RYHPT**: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã-—Å–æ–¥–µ—Ä–∂–∏–º—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º RYHPT

> –í–∞–∂–Ω–æ: —Å–∞–º `PBitmapFont` –Ω–µ –Ω–µ—Å—ë—Ç –∏–º–µ–Ω–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ TTF. –ò–º—è TTF –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ —Å–æ—Å–µ–¥–Ω–µ–≥–æ `.fgen` (–µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å) –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤–æ 2‚Äë–π —Å—Ç—Ä–æ–∫–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–≥–æ `.fgen`.

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (Extraction)
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Phyre SDK: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è `ObjectModel`, `Rendering`, `Serialization`, `PhyreInit()`
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è D3D11 `PRenderInterface` –Ω–∞ —Å–∫—Ä—ã—Ç–æ–º –æ–∫–Ω–µ ‚Äî –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç staging –¥–ª—è `map()`
3. –ê–Ω–∞–ª–∏–∑ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞: `PBinary::analyzeCluster()` ‚Üí `PBinary::loadCluster()`
4. –ü–æ–∏—Å–∫ `PBitmapFont` –∏ —á—Ç–µ–Ω–∏–µ `PTexture2D::map()`; –¥–µ–∫–æ–¥ –ø–∏–∫—Å–µ–ª–µ–π —Å —É—á—ë—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–∞
5. –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞ –∏ overlay
6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `.fgen` —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `PFGenParser` (—Å–º. –Ω–∏–∂–µ)

### –ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∞ (Repacking)
1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞**: –∞–Ω–∞–ª–∏–∑ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `.phyre` —Ñ–∞–π–ª–∞ —Å —à—Ä–∏—Ñ—Ç–æ–º
2. **–ü–∞—Ä—Å–∏–Ω–≥ `.fgen` —Ñ–∞–π–ª–∞**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∑–∞–º–µ–Ω—ã –∏ –ø—É—Ç–∏ –∫ –Ω–æ–≤–æ–º—É TTF
3. **–ü—Ä—è–º–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ FreeType**:
   - –ó–∞–≥—Ä—É–∑–∫–∞ TTF —á–µ—Ä–µ–∑ `PhyreFontLoadFont` –∏ `PhyreFontAllocateFont`
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ —á–µ—Ä–µ–∑ `FT_Set_Pixel_Sizes` (–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PhyreFont 40‚Üí28)
   - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–∂–¥–æ–≥–æ –≥–ª–∏—Ñ–∞ —á–µ—Ä–µ–∑ `FT_Load_Char` —Å `FT_LOAD_RENDER`
4. **–í—ã–±–æ—Ä–æ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≥–ª–∏—Ñ–æ–≤**:
   - –û—á–∏—Å—Ç–∫–∞ –æ–±–ª–∞—Å—Ç–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≥–ª–∏—Ñ–∞ –≤ —Ç–µ–∫—Å—Ç—É—Ä–µ
   - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–æ–≤–æ–≥–æ –≥–ª–∏—Ñ–∞ –≤ –±—É—Ñ–µ—Ä —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –ë–∏–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç TTF –∫ —Ä–∞–∑–º–µ—Ä—É –∞—Ç–ª–∞—Å–∞
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ rotated glyphs —Å –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ–º X/Y
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö –≥–ª–∏—Ñ–æ–≤**:
   - –ü—Ä–æ–ø—É—Å–∫ —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø—É—Å—Ç—ã–º bitmap (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ TTF)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≥–ª–∏—Ñ–∞ –¥–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å D3D11 platform ID**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PInstanceListConvert` –¥–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è D3D11
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Raw image block –¥–ª—è Generic —Ç–µ–∫—Å—Ç—É—Ä
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å platform-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–≥—Ä—ã

### –§–æ—Ä–º–∞—Ç .fgen (—Å–æ–≤–º–µ—Å—Ç–∏–º —Å Phyre Font Editor)
–°—Ç—Ä–æ–≥–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ:
1. `fgen`
2. `path/to/font.ttf` (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ñ–∞–π–ª–∞)
3. `DUMMY` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
4. `Fixed` (packing strategy)
5. `width`
6. `height`
7. `size`
8. `sdf` (0/1)
9. `charScale` (–æ–±—ã—á–Ω–æ 1)
10. `charPad` (–æ–±—ã—á–Ω–æ 0)
11. `mipPad` (–æ–±—ã—á–Ω–æ 0)
12+. –°–ø–∏—Å–æ–∫ hex‚Äë–∫–æ–¥–æ–≤ —Å–∏–º–≤–æ–ª–æ–≤, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞
### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Windows 10/11 x64
- Visual Studio 2022
- PhyreEngine SDK 3.26.0.0 (https://drive.google.com/file/d/1R1GeQszL6dMCHjk2yWSP9xvF9dcCFqDb/view?usp=sharing)
- NVIDIA Cg 3.1 Toolkit (x64): `C:\Program Files (x86)\NVIDIA Corporation\Cg\lib.x64\cg.lib`, `cgGL.lib`
- Windows SDK (–¥–ª—è `opengl32.lib`)
- (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ) –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `SCE_PHYRE` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ—Ä–µ–Ω—å SDK

### –°–±–æ—Ä–∫–∞ Phyre –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–æ–¥–∏–Ω —Ä–∞–∑)
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ª–∏–Ω–∫—É–µ—Ç—Å—è —Å Tool‚Äë–≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ Phyre –±–∏–±–ª–∏–æ—Ç–µ–∫. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã SDK –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π `PhyreUnpacker`:

1) PhyreCore (Tool x64 Debug)
```
"C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe" ^
  "PhyreEngine\Core\PhyreCore.sln" /m /v:m /p:Configuration=Debug /p:Platform=x64Tool
```

2) DeveloperExtensions (Tool x64 Debug)
```
"C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe" ^
  "PhyreEngine\DeveloperExtensions\PhyreDeveloperExtensions.sln" /m /v:m /p:Configuration=Debug /p:Platform=x64Tool
```
> –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π `ToolDebug|x64` –≤ IDE ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö.

### –°–±–æ—Ä–∫–∞ —á–µ—Ä–µ–∑ IDE
1. –û—Ç–∫—Ä–æ–π—Ç–µ `PhyreUnpacker.sln`
2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `Debug | x64`
3. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å ‚Äî –±–∏–Ω–∞—Ä—å: `PhyreUnpacker\x64\Debug\PhyreUnpacker.exe`

### –°–±–æ—Ä–∫–∞ –∏–∑ CLI
```
"C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe" ^
  PhyreUnpacker\PhyreUnpacker.sln /m /v:m /p:Configuration=Debug /p:Platform=x64
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ª–∏–Ω–∫–æ–≤–∫–∏ (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)
- Additional Include Directories: `PhyreEngine\Include`
- Additional Library Directories: `PhyreEngine\Lib\Win64`, `C:\\Program Files (x86)\\NVIDIA Corporation\\Cg\\lib.x64`
- Additional Dependencies: `PhyreCoreToolD.lib; PhyreDeveloperExtensionsToolD.lib; luaD.lib; cg.lib; cgGL.lib; opengl32.lib`

> –ï—Å–ª–∏ Cg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∏–Ω–æ–µ –º–µ—Å—Ç–æ, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø—É—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫ (`Linker ‚Üí Additional Library Directories`) –¥–ª—è `cg.lib`, `cgGL.lib`.

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Cg (–∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—É—Ç–∏)
–ï—Å–ª–∏ Cg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ Cg: `C/C++ ‚Üí General ‚Üí Additional Include Directories` ‚Üí `C:\path\to\Cg\include`
- –î–æ–±–∞–≤—å—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Cg: `Linker ‚Üí General ‚Üí Additional Library Directories` ‚Üí `C:\path\to\Cg\lib.x64`
- –£–∫–∞–∂–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `Linker ‚Üí Input ‚Üí Additional Dependencies` ‚Üí `cg.lib; cgGL.lib`
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ä–∞–Ω—Ç–∞–π–º–∞) –î–æ–±–∞–≤—å—Ç–µ `C:\path\to\Cg\bin.x64` –≤ `PATH`, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –Ω—É–∂–Ω—ã `cg.dll/cgGL.dll` –≤ —Ä–∞–Ω—Ç–∞–π–º–µ

### –ì–¥–µ –º–µ–Ω—è—Ç—å –≤ Visual Studio (Property Pages)
–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞ `PhyreUnpacker` –ø–æ–¥ `Configuration: Debug`, `Platform: x64`:
- C/C++ ‚Üí General ‚Üí Additional Include Directories:
  - `$(ProjectDir)..\PhyreEngine\Include`
  - `C:\Program Files (x86)\NVIDIA Corporation\Cg\include` (–∏–ª–∏ –≤–∞—à –ø—É—Ç—å)
- Linker ‚Üí General ‚Üí Additional Library Directories:
  - `$(ProjectDir)..\PhyreEngine\Lib\Win64`
  - `C:\Program Files (x86)\NVIDIA Corporation\Cg\lib.x64` (–∏–ª–∏ –≤–∞—à –ø—É—Ç—å)
- Linker ‚Üí Input ‚Üí Additional Dependencies:
  - `PhyreCoreToolD.lib; PhyreDeveloperExtensionsToolD.lib; luaD.lib; cg.lib; cgGL.lib; opengl32.lib`
> –ü—Ä–∏ —Å–±–æ—Ä–∫–µ `Release` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `Tool`‚Äë–≤–∞—Ä–∏–∞–Ω—Ç—ã –±–∏–±–ª–∏–æ—Ç–µ–∫ (`PhyreCoreTool.lib` –∏ —Ç.–ø.).

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
PhyreUnpacker [options] <input_file>
PhyreUnpacker --batch [options]
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ü–∏–∏

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `-h, --help` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |
| `-v, --version` | –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏ |
| `-i, --input <file>` | –í—Ö–æ–¥–Ω–æ–π `.phyre` —Ñ–∞–π–ª |
| `-d, --input-dir <dir>` | –í—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (–ø–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º) |
| `-o, --output <dir>` | –í—ã—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è |
| `-b, --batch` | –í–∫–ª—é—á–∏—Ç—å –ø–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `--verbose` | –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ |

### –ê–Ω–∞–ª–∏–∑ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `-a, --analyze <file>` | –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –º–æ–∂–µ—Ç –ª–∏ –æ–Ω –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω PhyreEngine |
| `--compare-fgen <orig.fgen> <mod.fgen>` | –°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–∞ `.fgen` —Ñ–∞–π–ª–∞ –∏ –∑–∞–ø–∏—Å–∞—Ç—å –æ—Ç—á—ë—Ç –≤ `--output` |
| `--compare-binary-dumps <file1> <file2>` | –°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–∞ –ø–æ–±–∞–π—Ç–æ–≤–æ |

### –†–∞–±–æ—Ç–∞ —Å –∞—Ä—Ö–∏–≤–∞–º–∏

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `--extract-ofs3, --extract-l2b <archive>` | –ò–∑–≤–ª–µ—á—å OFS3 –∞—Ä—Ö–∏–≤ (`.l2b` —Ñ–∞–π–ª) |

### –ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `--repack-phyre` | –ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∞—Ç—å –≤ `.phyre` |
| `--repack-source <src.phyre>` | –ò—Å—Ö–æ–¥–Ω—ã–π `.phyre` —Ñ–∞–π–ª –¥–ª—è –±–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è |
| `--repack-out <out.phyre>` | –ü—É—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–≥–æ `.phyre` —Ñ–∞–π–ª–∞ |
| `--repack-fgen <file.fgen>` | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `.fgen` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–∏–º—è TTF/–Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤) |
| `--repack-keep-atlas` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞—Ç–ª–∞—Å–∞/UV (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ) |
| `--repack-only-listed` | –ó–∞–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –≥–ª–∏—Ñ—ã, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –≤ `.fgen` |
| `--repack-ttf-name <TTF.ttf>` | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–º—è TTF –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `.fgen` |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞
```bash
PhyreUnpacker font00.fgen.phyre -o ./output
PhyreUnpacker -i font00.fgen.phyre -o ./output --verbose
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ `output/`:**
- `*_texture.ppm` ‚Äî –∞—Ç–ª–∞—Å —à—Ä–∏—Ñ—Ç–∞ (L8 ‚Üí RGB PPM)
- `*_metadata.xml` ‚Äî —Ä–∞–∑–º–µ—Ä—ã, SDF, lineSpacing, baseline
- `*_characters.json` ‚Äî –≥–ª–∏—Ñ—ã/UV/offset/advance/–∫–µ—Ä–Ω–∏–Ω–≥
- `*.fgen` ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–∞–π–ª, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Phyre Font Editor
- `*_validate.txt` ‚Äî –æ—Ç—á—ë—Ç UV ‚Üî –ø–∏–∫—Å–µ–ª–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –Ω—É–ª–µ–≤—ã–µ –≥–ª–∏—Ñ—ã (space/nbsp)
- `*_overlay.ppm` ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π ‚Äî OOB, –∫—Ä–∞—Å–Ω—ã–π ‚Äî –ø—É—Å—Ç–æ, –∂—ë–ª—Ç—ã–π ‚Äî sparse)
- (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –≤–Ω–µ—à–Ω–∏–π `.fgen`) –∫–æ–ø–∏—è `.fgen` –∏ `<name>.ttf.name.txt` ‚Äî —Å—Ç—Ä–æ–∫–∞ 2 `.fgen` (–ø—É—Ç—å TTF)

#### –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```bash
PhyreUnpacker --batch -d ./fonts -o ./extracted
```

#### –ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∞ —à—Ä–∏—Ñ—Ç–∞
```bash
PhyreUnpacker.exe --repack-phyre --repack-source "font00.fgen.phyre" --repack-out "out47\font00.fgen.phyre" --repack-fgen "nwe90.fgen" --repack-only-listed
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –Ω–æ–≤—ã–π `.phyre` —Ñ–∞–π–ª —Å –∑–∞–º–µ–Ω—ë–Ω–Ω—ã–º–∏ –≥–ª–∏—Ñ–∞–º–∏ –∏–∑ TTF, –≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –∏–≥—Ä–µ.

#### –†–∞–±–æ—Ç–∞ —Å –∞—Ä—Ö–∏–≤–∞–º–∏
```bash
PhyreUnpacker --analyze file.l2b                    # –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ .l2b —Ñ–∞–π–ª–∞
PhyreUnpacker --extract-ofs3 file.l2b -o ./extracted  # –ò–∑–≤–ª–µ—á—å .l2b –∞—Ä—Ö–∏–≤
```

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```bash
PhyreUnpacker --compare-fgen a.fgen b.fgen -o ./report
```

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –ß—ë—Ä–Ω–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è D3D11 `PRenderInterface` (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏). –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç (DXT/BC)
- Font Editor –ø–∏—à–µ—Ç "invalid font": –ø—Ä–æ–≤–µ—Ä—å—Ç–µ 11 –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–æ–∫ `.fgen` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å TTF –≤ —Å—Ç—Ä–æ–∫–µ 2
- –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ UV: —Å–º–æ—Ç—Ä–∏—Ç–µ `*_validate.txt`/`*_overlay.ppm`

---

## –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ (–∫–∞–∫ –º—ã –ø—Ä–∏—à–ª–∏ –∫ —É—Å–ø–µ—Ö—É)

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (Extraction)
1. DX11 `.phyre` –Ω–µ –≥—Ä—É–∑–∏–ª—Å—è –Ω–∞–ø—Ä—è–º—É—é ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ `analyzeCluster + loadCluster` —Å namespace mapping
2. `map()` –≤–æ–∑–≤—Ä–∞—â–∞–ª `null` ‚Üí –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è D3D11 `PRenderInterface` –Ω–∞ —Å–∫—Ä—ã—Ç–æ–º –æ–∫–Ω–µ (staging CopyResource)
3. –†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –¥–µ–∫–æ–¥ L8/A8/LA8/RGBA8/ARGB8 + DXT1/3/5/BC4
4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π `.fgen` —Å—Ç—Ä–æ–≥–æ –ø–æ `PFGenParser`
5. –î–æ–±–∞–≤–∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä UV –∏ overlay, –∏–≥–Ω–æ—Ä –Ω—É–ª–µ–≤—ã—Ö –≥–ª–∏—Ñ–æ–≤
6. –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫—É –∏–º–µ–Ω–∏ TTF –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `.fgen` (–µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

### –ü–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∞ (Repacking)
1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å platform ID**: –ø–µ—Ä–µ—É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å —Å Generic –≤–º–µ—Å—Ç–æ D3D11 ‚Üí –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç –≤ –∏–≥—Ä–µ
   - **–†–µ—à–µ–Ω–∏–µ**: —è–≤–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è D3D11 converter –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PInstanceListConvert` –ø—Ä–∏ `saveCluster`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥–ª–∏—Ñ—ã**: –ø–æ—Å–ª–µ D3D11 —Ç–µ–∫—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è, –Ω–æ –≥–ª–∏—Ñ—ã –±—ã–ª–∏ –ø–µ—Ä–µ–ø—É—Ç–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'A' –≤–º–µ—Å—Ç–æ 't')
   - **–†–µ—à–µ–Ω–∏–µ**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ ‚Äî `PhyreFontLoadFont` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª 40, –Ω—É–∂–Ω–æ 28 —á–µ—Ä–µ–∑ `FT_Set_Pixel_Sizes` –æ–¥–∏–Ω —Ä–∞–∑ –î–û —Ü–∏–∫–ª–∞
3. **–ü—É—Å—Ç—ã–µ –≥–ª–∏—Ñ—ã –∏–∑ TTF**: FreeType –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø—É—Å—Ç–æ–π bitmap –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ**: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `bitmap.width/rows/buffer` –∏ –ø–æ–¥—Å—á—ë—Ç –Ω–µ–Ω—É–ª–µ–≤—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π —Å –ø–æ—Ä–æ–≥–æ–º –¥–ª—è "–º—É—Å–æ—Ä–Ω—ã—Ö" –≥–ª–∏—Ñ–æ–≤
4. **Rotated glyphs**: –¥–ª—è –ø–æ–≤–µ—Ä–Ω—É—Ç—ã—Ö –≥–ª–∏—Ñ–æ–≤ –Ω—É–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–µ–Ω—è—Ç—å X/Y –ø—Ä–∏ –∑–∞–ø–∏—Å–∏
   - **–†–µ—à–µ–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑ `PhyreFontLibrary.cpp:665` ‚Äî `pt = buffer + width * (xx + y) + (x + yy)` –¥–ª—è rotated
5. **–ë–∏–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è**: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ TTF –∫ —Ü–µ–ª–µ–≤–æ–º—É —Ä–∞–∑–º–µ—Ä—É –≤ –∞—Ç–ª–∞—Å–µ
   - **–†–µ—à–µ–Ω–∏–µ**: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –≤—ã–±–æ—Ä–∫–∞ 4 –ø–∏–∫—Å–µ–ª–µ–π, –≤–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
6. **–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ bitmap**: —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–∏—Ñ–∞ –≤ –±—É—Ñ–µ—Ä–µ –∫–∞–∫ –≤ PhyreEngine
   - **–†–µ—à–µ–Ω–∏–µ**: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π `tXOff/tYOff` –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è bitmap –≤ –±—É—Ñ–µ—Ä–µ –ø–µ—Ä–µ–¥ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º
7. **Generic —Ç–µ–∫—Å—Ç—É—Ä—ã**: –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ `workingTexture` –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –∫ Raw image block
   - **–†–µ—à–µ–Ω–∏–µ**: —è–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `workingTexture` –≤ `rawBlock->m_data` –¥–ª—è Generic —Ç–µ–∫—Å—Ç—É—Ä

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –ø–µ—Ä–µ—É–ø–∞–∫–æ–≤–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `PhyreFontRepacker.cpp`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `applyGeneratedTextureToCluster`:**
- –ß—Ç–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç—É—Ä—ã —á–µ—Ä–µ–∑ `PTexture2D::map()` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π stride
- –°–æ–∑–¥–∞–Ω–∏–µ `workingTexture` –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
- –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —Å–∏–º–≤–æ–ª–∞–º –∏–∑ `.fgen` –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–π –∑–∞–º–µ–Ω—ã

**–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ FreeType:**
- `PhyreFontAllocateFont()` ‚Üí `PhyreFontLoadFont()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ TTF
- `FT_Set_Pixel_Sizes(face, 0, fontSize)` –û–î–ò–ù –†–ê–ó –ø–µ—Ä–µ–¥ —Ü–∏–∫–ª–æ–º —Å–∏–º–≤–æ–ª–æ–≤
- `FT_Load_Char(face, charCode, FT_LOAD_RENDER)` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–ª–∏—Ñ–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π bitmap: `width/rows/buffer` –∏ –ø–æ–¥—Å—á—ë—Ç –Ω–µ–Ω—É–ª–µ–≤—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π

**–û–±—Ä–∞–±–æ—Ç–∫–∞ rotated glyphs:**
```cpp
// –û—á–∏—Å—Ç–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 462-469)
for (yy = 0; yy < srcH; yy++)
    for (xx = 0; xx < srcW; xx++)
        offset = (srcY + xx) * textureWidth + (srcX + yy)

// –ó–∞–ø–∏—Å—å (—Å—Ç—Ä–æ–∫–∞ 640)
targetOffset = (srcY + px) * textureWidth + (srcX + py)
```

**–ë–∏–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è:**
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: `fx = px / srcW`, `fy = py / srcH`
- –í—ã–±–æ—Ä–∫–∞ 4 –ø–∏–∫—Å–µ–ª–µ–π: `offset = (y0 + tYOff) * bufferW + (x0 + tXOff)`
- –í–µ—Å–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã: `wx = srcCoordX - x0`, `wy = srcCoordY - y0`
- –§–æ—Ä–º—É–ª–∞: `gray = g00*(1-wx)*(1-wy) + g01*wx*(1-wy) + g10*(1-wx)*wy + g11*wx*wy`

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å D3D11:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: `Phyre::PPlatform::BindPlatformConverterD3D11(platformId)` —á–µ—Ä–µ–∑ `PhyreInit`
- –ü–æ–ª—É—á–µ–Ω–∏–µ layout: `Find("D3D11")->getClassLayout()`
- –ü–æ–ª—É—á–µ–Ω–∏–µ converter: `Find("D3D11")->getInstanceListConvert()`
- –í—ã–∑–æ–≤: `saveCluster(cluster, writer, d3d11ClassLayout, d3d11Convert)`

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º —Ñ–∞–π–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `PhyreUnpacker/docs/`:

- **[OFS3_FORMAT.md](PhyreUnpacker/docs/OFS3_FORMAT.md)** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ OFS3 –∞—Ä—Ö–∏–≤–æ–≤
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —Ç–∞–±–ª–∏—Ü—ã —Ñ–∞–π–ª–æ–≤
  - –ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
  - –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
  - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- **[L2B_FORMAT.md](PhyreUnpacker/docs/L2B_FORMAT.md)** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ L2B (Level 2 Binary) —Ñ–∞–π–ª–æ–≤
  - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–æ–≤ —É—Ä–æ–≤–Ω—è
  - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
  - –°–≤—è–∑—å —Å PhyreEngine —É—Ä–æ–≤–Ω—è–º–∏
  - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö

### –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã —à—Ä–∏—Ñ—Ç–æ–≤ PhyreEngine

**üìñ [PhyreEngine_Font_System_Analysis.md](PhyreEngine_Font_System_Analysis.md)** ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã —à—Ä–∏—Ñ—Ç–æ–≤ PhyreEngine

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã PhyreEngine —Å —à—Ä–∏—Ñ—Ç–∞–º–∏, –≤–∫–ª—é—á–∞—è:

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã:** –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã (`PBitmapFont`, `PBitmapFontCharInfo`, `PBitmapFontText`, `PBitmapTextMaterial`, `PBitmapTextMaterialSDF`)
- **–§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤:** –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `.fgen` –∏ `.phyre` —Ñ–∞–π–ª–æ–≤
- **–¢–µ—Ö–Ω–∏–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:** 7 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞ (Alpha Blend, SDF Hard/Soft Edges, Outline, Shadow, Glow)
- **–®–µ–π–¥–µ—Ä—ã:** –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä `PhyreText.fx` —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è D3D11/GNM/GL
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** –æ–ø–∏—Å–∞–Ω–∏–µ PhyreFontEditor –∏ PhyreAssetProcessor
- **–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏:** –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è `.phyre` —Ñ–∞–π–ª–æ–≤ —Å–æ —à—Ä–∏—Ñ—Ç–∞–º–∏ (5 —ç—Ç–∞–ø–æ–≤)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `.phyre`:** –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —Å–µ–∫—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ:** –∞–Ω–∞–ª–∏–∑ –∑–∞—â–∏—Ç—ã —Ñ–∞–π–ª–æ–≤ (fixup –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
- **–î–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –≤ SDK:** –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ `.phyre` —Ñ–∞–π–ª–æ–≤

---

## –õ–∏—Ü–µ–Ω–∑–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PhyreEngine SDK. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–±–ª—é–¥–∞—è –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è SDK –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–≥—Ä.

**PhyreUnpacker v2.0** ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ–º –∏ –ø–µ—Ä–µ—É–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —à—Ä–∏—Ñ—Ç—ã –∏–∑ `.phyre` —Å –≤—ã–±–æ—Ä–æ—á–Ω–æ–π –∑–∞–º–µ–Ω–æ–π –≥–ª–∏—Ñ–æ–≤ —á–µ—Ä–µ–∑ FreeType API.
